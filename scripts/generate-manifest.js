// scripts/generate-manifest.js
const fs = require('fs');
const path = require('path');
const matter = require('gray-matter');

const POSTS_DIR = path.join(__dirname, '../src/app/blog/posts');
const OUT_FILE = path.join(POSTS_DIR, 'manifest.ts');
const SITE_URL = 'https://teds.one';

const files = fs.readdirSync(POSTS_DIR).filter(f => f.endsWith('.mdx'));

const posts = files.map(filename => {
  const filePath = path.join(POSTS_DIR, filename);
  const raw = fs.readFileSync(filePath, 'utf8');
  const { data } = matter(raw);
  const title = data.title || filename.replace(/\.mdx$/, '');
  return {
    title,
    slug: filename.replace(/\.mdx$/, ''),
    date: data.publishedAt || '',
    summary: data.summary || data.description || '',
    image: `${SITE_URL}/api/og/generate?title=${encodeURIComponent(title)}`,
  };
});

const manifest = `// Auto-generated by scripts/generate-manifest.js\nexport interface BlogPostMeta {\n  title: string;\n  slug: string;\n  date: string;\n  summary?: string;\n  image?: string;\n}\n\nexport const posts: BlogPostMeta[] = ${JSON.stringify(posts, null, 2)};\n`;
fs.writeFileSync(OUT_FILE, manifest);
console.log(`Manifest generated with ${posts.length} posts.`);
